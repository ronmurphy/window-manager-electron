<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WriteFlow - Modern Text Editor</title>
    <meta name="description" content="A user-friendly, feature-rich text editor for everyone. Create beautiful documents with ease.">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4a90e2;
            --secondary-color: #f5f6fa;
            --text-color: #2c3e50;
            --border-color: #e1e8ed;
            --bg-color: #ffffff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }

        body.dark-mode {
            --bg-color: #1a1a1a;
            --text-color: #ffffff;
            --secondary-color: #2d2d2d;
            --border-color: #404040;
        }

        body.dark-mode .btn {
            background: var(--secondary-color);
            color: var(--text-color);
        }

        body.dark-mode .tab {
            background: var(--secondary-color);
            color: var(--text-color);
        }

        body.dark-mode .modal-content,
        body.dark-mode .dropdown-content,
        body.dark-mode .color-picker,
        body.dark-mode .emoji-picker {
            background: var(--bg-color);
            color: var(--text-color);
        }

        body.dark-mode .dropdown-content a {
            color: var(--text-color);
        }

        body.dark-mode .dropdown-content a:hover {
            background: var(--secondary-color);
        }

        [data-tooltip] {
            position: relative;
        }

        [data-tooltip]:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .toolbar {
            background: var(--secondary-color);
            padding: 10px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .toolbar-group {
            display: flex;
            gap: 5px;
            align-items: center;
            padding: 0 10px;
            border-right: 1px solid var(--border-color);
        }

        .toolbar-group:last-child {
            border-right: none;
        }

        .btn {
            padding: 8px 12px;
            border: none;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.2s;
        }

        .btn:hover {
            background: var(--primary-color);
            color: white;
        }

        .btn.active {
            background: var(--primary-color);
            color: white;
        }

        .editor {
            flex-grow: 1;
            padding: 20px;
            overflow: hidden;
            position: relative;
        }

        #content {
            width: 100%;
            height: 100%;
            padding: 20px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            outline: none;
            font-size: 16px;
            line-height: 1.6;
            overflow-y: auto;
            overflow-x: hidden;
            word-wrap: break-word;
            word-break: break-word;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 8px;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .font-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 20px;
        }

        .tab-btn {
            padding: 10px 20px;
            border: none;
            background: none;
            cursor: pointer;
            color: var(--text-color);
            border-bottom: 2px solid transparent;
        }

        .tab-btn.active {
            border-bottom: 2px solid var(--primary-color);
            color: var(--primary-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .font-list, .favorites-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }

        .font-list .loading,
        .font-list .error {
            grid-column: 1 / -1;
            text-align: center;
            padding: 20px;
            background: var(--secondary-color);
            border-radius: 4px;
        }

        .font-list .error {
            color: #ff4444;
        }

        .help-page {
            display: none;
            margin: 20px 0;
            line-height: 1.6;
        }

        .help-page.active {
            display: block;
        }

        .help-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        .help-content h2 {
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        .help-content h3 {
            margin: 20px 0 10px;
        }

        .help-content p {
            margin-bottom: 15px;
        }

        .help-content ul {
            margin-left: 20px;
        }

        .help-content li {
            margin: 10px 0;
        }

        .font-preview-area {
            background: var(--bg-color);
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
        }

        .font-preview-area .preview-text {
            font-size: 18px;
            line-height: 1.5;
            margin: 0;
        }

        .font-item {
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .favorite-btn,
        .use-font-btn {
            padding: 8px 12px;
            border: none;
            background: var(--secondary-color);
            border-radius: 4px;
            cursor: pointer;
            color: var(--text-color);
            transition: all 0.2s;
            margin-left: 8px;
        }

        .favorite-btn:hover,
        .use-font-btn:hover {
            background: var(--primary-color);
            color: white;
        }

        .favorite-btn.active {
            background: var(--primary-color);
            color: white;
        }

        .font-preview {
            margin-bottom: 8px;
        }

        .preview-text {
            font-size: 14px;
            color: #666;
            margin-top: 4px;
        }

        .use-font-btn {
            padding: 4px 8px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 8px;
        }

        /* Tabs styles */
        .tabs-container {
            display: flex;
            background: var(--secondary-color);
            padding: 8px 8px 0;
            overflow-x: auto;
            border-bottom: 1px solid var(--border-color);
        }

        /* .tab {
            padding: 8px 16px;
            background: white;
            border: 1px solid var(--border-color);
            border-bottom: none;
            border-radius: 4px 4px 0 0;
            margin-right: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        } */

        .tab {
            padding: 6px 12px;
            background: #e0e0e0;
            border: none;
            border-radius: 4px 4px 0 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 100px;
            max-width: 200px;
        }

        .tab.active {
            background: var(--primary-color);
            color: white;
        }

        .tab-close {
            width: 16px;
            height: 16px;
            line-height: 16px;
            text-align: center;
            border-radius: 50%;
        }

        .tab:hover .tab-close {
            background: rgba(0,0,0,0.1);
        }

        .new-tab-btn {
            padding: 8px;
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-color);
        }

        /* Emoji picker */
        .emoji-picker {
            display: none;
            position: absolute;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            padding: 10px;
            z-index: 1000;
            width: 300px;
            max-height: 400px;
            overflow-y: auto;
        }

        .emoji-categories {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 5px;
        }

        .emoji-category {
            padding: 5px;
            cursor: pointer;
            border-radius: 4px;
        }

        .emoji-category:hover {
            background: var(--secondary-color);
        }

        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 5px;
        }

        .emoji {
            padding: 5px;
            cursor: pointer;
            text-align: center;
            border-radius: 4px;
        }

        .emoji:hover {
            background: var(--secondary-color);
        }

        .font-item:hover {
            background: var(--secondary-color);
        }

        .font-search {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            margin-bottom: 10px;
        }

        .status-bar {
            background: var(--secondary-color);
            padding: 5px 10px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
        }

        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            background: white;
            min-width: 160px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 1;
        }

        .dropdown-content a {
            padding: 8px 12px;
            display: block;
            text-decoration: none;
            color: var(--text-color);
        }

        .dropdown-content a:hover {
            background: var(--secondary-color);
        }

        .show {
            display: block;
        }

        /* Color picker styles */
        .color-picker {
            display: none;
            position: absolute;
            background: white;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .color-option {
            width: 20px;
            height: 20px;
            margin: 2px;
            border-radius: 50%;
            cursor: pointer;
        }

    </style>
</head>
<body>
    <div class="container">
        <div class="tabs-container">
            <div class="tab active">
                Document 1
                <span class="tab-close">√ó</span>
            </div>
            <button class="new-tab-btn">
                <i class="fas fa-plus"></i>
            </button>
        </div>
        <div class="toolbar">
            <div class="toolbar-group">
                <button class="btn" id="newFile">
                    <i class="fas fa-file"></i>
                    New
                </button>
                <button class="btn" id="openFile">
                    <i class="fas fa-folder-open"></i>
                    Open
                </button>
                <button class="btn" id="saveFile">
                    <i class="fas fa-save"></i>
                    Save
                </button>
            </div>
            
            <div class="toolbar-group">
                <button class="btn" data-command="bold">
                    <i class="fas fa-bold"></i>
                </button>
                <button class="btn" data-command="italic">
                    <i class="fas fa-italic"></i>
                </button>
                <button class="btn" data-command="underline">
                    <i class="fas fa-underline"></i>
                </button>
                <button class="btn" data-command="strikeThrough">
                    <i class="fas fa-strikethrough"></i>
                </button>
            </div>

            <div class="toolbar-group">
                <button class="btn" data-command="justifyLeft">
                    <i class="fas fa-align-left"></i>
                </button>
                <button class="btn" data-command="justifyCenter">
                    <i class="fas fa-align-center"></i>
                </button>
                <button class="btn" data-command="justifyRight">
                    <i class="fas fa-align-right"></i>
                </button>
                <button class="btn" data-command="justifyFull">
                    <i class="fas fa-align-justify"></i>
                </button>
            </div>

            <div class="toolbar-group">
                <button class="btn" id="fontBtn">
                    <i class="fas fa-font"></i>
                    Fonts
                </button>
                <button class="btn" id="decreaseFont" data-tooltip="Decrease Font Size">
                    <i class="fas fa-minus"></i>
                </button>
                <button class="btn" id="increaseFont" data-tooltip="Increase Font Size">
                    <i class="fas fa-plus"></i>
                </button>
                <button class="btn" id="resetFont" data-tooltip="Reset Font Size">
                    <i class="fas fa-undo"></i>
                </button>
            </div>

            <div class="toolbar-group">
                <button class="btn" id="undoBtn" data-tooltip="Undo">
                    <i class="fas fa-undo"></i>
                </button>
                <button class="btn" id="redoBtn" data-tooltip="Redo">
                    <i class="fas fa-redo"></i>
                </button>
            </div>

            <div class="toolbar-group">
                <button class="btn" id="textColor">
                    <i class="fas fa-paint-brush"></i>
                </button>
                <button class="btn" id="highlight">
                    <i class="fas fa-highlighter"></i>
                </button>
            </div>

            <div class="toolbar-group">
                <button class="btn" data-command="insertUnorderedList">
                    <i class="fas fa-list-ul"></i>
                </button>
                <button class="btn" data-command="insertOrderedList">
                    <i class="fas fa-list-ol"></i>
                </button>
                <button class="btn" id="insertLink" data-tooltip="Insert Link">
                    <i class="fas fa-link"></i>
                </button>
                <button class="btn" id="insertImage" data-tooltip="Insert Image">
                    <i class="fas fa-image"></i>
                </button>
            </div>

            <div class="toolbar-group">
                <button class="btn" id="toggleDarkMode" data-tooltip="Toggle Dark/Light Mode">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="btn" id="toggleSpeech" data-tooltip="Toggle Text-to-Speech">
                    <i class="fas fa-volume-up"></i>
                </button>
            </div>

            <div class="toolbar-group">
                <button class="btn" id="emojiBtn" data-tooltip="Insert Emoji">
                    <i class="fas fa-smile"></i>
                </button>
                <button class="btn" id="helpBtn" data-tooltip="Help">
                    <i class="fas fa-question-circle"></i>
                </button>
            </div>
        </div>

        <div class="editor">
            <div id="content" contenteditable="true"></div>
        </div>

        <div class="status-bar">
            <span id="wordCount">Words: 0</span>
            <span id="charCount">Characters: 0</span>
        </div>
    </div>

    <!-- Font Modal -->
    <div id="fontModal" class="modal">
        <div class="modal-content">
            <h2>Choose Font</h2>
            <div class="font-preview-area">
                <p class="preview-text">The quick brown fox jumps over the lazy dog</p>
            </div>
            <div class="font-tabs">
                <button class="tab-btn active" data-tab="favorites">Favorites</button>
                <button class="tab-btn" data-tab="search">Search Fonts</button>
            </div>
            <div class="tab-content" id="favorites">
                <div class="favorites-list"></div>
            </div>
            <div class="tab-content" id="search">
                <input type="text" class="font-search" placeholder="Search fonts...">
                <div class="font-list"></div>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div id="helpModal" class="modal">
        <div class="modal-content">
            <h2>WriteFlow Editor Help</h2>
            <div class="help-content">
                <div class="help-page" data-page="1">
                    <h2>Getting Started</h2>
                    <p>Welcome to WriteFlow! This powerful text editor is designed to make document creation easy and enjoyable. Here's what you need to know:</p>
                    
                    <h3>File Operations</h3>
                    <ul>
                        <li><i class="fas fa-file"></i> <strong>New</strong> - Create a fresh document, perfect for starting your next project</li>
                        <li><i class="fas fa-folder-open"></i> <strong>Open</strong> - Access your existing documents (supports .md.txt files)</li>
                        <li><i class="fas fa-save"></i> <strong>Save</strong> - Store your work safely on your device</li>
                    </ul>

                    <h3>Document Management</h3>
                    <p>Use tabs to work on multiple documents simultaneously. Each tab maintains its own content and formatting.</p>
                </div>

                <div class="help-page" data-page="2">
                    <h2>Text Formatting</h2>
                    <p>Make your text stand out with these formatting options:</p>
                    
                    <h3>Basic Formatting</h3>
                    <ul>
                        <li><i class="fas fa-bold"></i> <strong>Bold</strong> - Emphasize important text (Ctrl+B)</li>
                        <li><i class="fas fa-italic"></i> <strong>Italic</strong> - Add subtle emphasis (Ctrl+I)</li>
                        <li><i class="fas fa-underline"></i> <strong>Underline</strong> - Highlight key points (Ctrl+U)</li>
                        <li><i class="fas fa-strikethrough"></i> <strong>Strikethrough</strong> - Mark revised text</li>
                    </ul>

                    <h3>Text Alignment</h3>
                    <ul>
                        <li><i class="fas fa-align-left"></i> <strong>Left Align</strong> - Standard text alignment</li>
                        <li><i class="fas fa-align-center"></i> <strong>Center</strong> - Perfect for titles and headings</li>
                        <li><i class="fas fa-align-right"></i> <strong>Right Align</strong> - Ideal for dates or signatures</li>
                        <li><i class="fas fa-align-justify"></i> <strong>Justify</strong> - Create clean, even margins</li>
                    </ul>
                </div>

                <div class="help-page" data-page="3">
                    <h2>Advanced Features</h2>
                    
                    <h3>Font Customization</h3>
                    <ul>
                        <li><i class="fas fa-font"></i> <strong>Fonts</strong> - Access hundreds of Google Fonts</li>
                        <li><i class="fas fa-star"></i> <strong>Favorites</strong> - Save your preferred fonts for quick access</li>
                        <li><i class="fas fa-minus"></i> <strong>Decrease Size</strong> - Make text smaller</li>
                        <li><i class="fas fa-plus"></i> <strong>Increase Size</strong> - Make text larger</li>
                    </ul>

                    <h3>Color Options</h3>
                    <ul>
                        <li><i class="fas fa-paint-brush"></i> <strong>Text Color</strong> - Change the color of your text</li>
                        <li><i class="fas fa-highlighter"></i> <strong>Highlight</strong> - Add background color to text</li>
                    </ul>

                    <h3>Lists and Structure</h3>
                    <ul>
                        <li><i class="fas fa-list-ul"></i> <strong>Bullet List</strong> - Create unordered lists</li>
                        <li><i class="fas fa-list-ol"></i> <strong>Numbered List</strong> - Create ordered lists</li>
                    </ul>
                </div>

                <div class="help-page" data-page="4">
                    <h2>Enhanced Features</h2>
                    
                    <h3>Media Integration</h3>
                    <ul>
                        <li><i class="fas fa-link"></i> <strong>Insert Link</strong> - Add clickable links to websites</li>
                        <li><i class="fas fa-image"></i> <strong>Insert Image</strong> - Include images from URLs</li>
                        <li><i class="fas fa-smile"></i> <strong>Emojis</strong> - Add expressive emoji characters</li>
                    </ul>

                    <h3>Accessibility Features</h3>
                    <ul>
                        <li><i class="fas fa-moon"></i> <strong>Dark/Light Mode</strong> - Adjust the interface for comfort</li>
                        <li><i class="fas fa-volume-up"></i> <strong>Text-to-Speech</strong> - Have your content read aloud</li>
                    </ul>

                    <h3>Additional Tips</h3>
                    <p>Hover over any button to see a tooltip explaining its function.</p>
                    <p>Use keyboard shortcuts (Ctrl+S to save, Ctrl+O to open) for faster workflow.</p>
                </div>

                <div class="help-navigation">
                    <button class="btn" id="prevPage">Previous</button>
                    <span id="pageIndicator">Page 1 of 4</span>
                    <button class="btn" id="nextPage">Next</button>
                </div>
            </div>
            <button class="btn" id="closeHelp">Close</button>
        </div>
    </div>

    <!-- Color Picker -->
    <div id="colorPicker" class="color-picker">
        <div class="color-option" style="background: #000000"></div>
        <div class="color-option" style="background: #ff0000"></div>
        <div class="color-option" style="background: #00ff00"></div>
        <div class="color-option" style="background: #0000ff"></div>
        <div class="color-option" style="background: #ffff00"></div>
        <div class="color-option" style="background: #ff00ff"></div>
        <div class="color-option" style="background: #00ffff"></div>
    </div>

    <!-- Emoji Picker -->
    <div class="emoji-picker">
        <div class="emoji-categories">
            <div class="emoji-category" data-category="smileys">üòÄ</div>
            <div class="emoji-category" data-category="people">üëã</div>
            <div class="emoji-category" data-category="animals">üê∂</div>
            <div class="emoji-category" data-category="food">üçé</div>
            <div class="emoji-category" data-category="activities">‚öΩ</div>
            <div class="emoji-category" data-category="travel">üöó</div>
            <div class="emoji-category" data-category="objects">üí°</div>
            <div class="emoji-category" data-category="symbols">‚ù§Ô∏è</div>
        </div>
        <div class="emoji-grid"></div>
    </div>

    <script src="https://apis.google.com/js/api.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const editor = document.getElementById('content');
            const wordCount = document.getElementById('wordCount');
            const charCount = document.getElementById('charCount');
            const fontModal = document.getElementById('fontModal');
            const fontSearch = document.querySelector('.font-search');
            const fontList = document.querySelector('.font-list');
            const colorPicker = document.getElementById('colorPicker');
            
            let favorites = JSON.parse(localStorage.getItem('favoriteFonts') || '[]');

            // Initialize editor with default content
            editor.innerHTML = '<p>Start writing something amazing...</p>';

            // Command buttons
            document.querySelectorAll('.btn[data-command]').forEach(button => {
                button.addEventListener('click', () => {
                    const command = button.getAttribute('data-command');
                    document.execCommand(command, false, null);
                    button.classList.toggle('active');
                });
            });

            // Initialize undo/redo history
            let undoStack = [];
            let redoStack = [];
            const MAX_HISTORY = 20;

            function saveToHistory() {
                undoStack.push(editor.innerHTML);
                if (undoStack.length > MAX_HISTORY) {
                    undoStack.shift();
                }
                redoStack = [];
                updateUndoRedoButtons();
            }

            function updateUndoRedoButtons() {
                document.getElementById('undoBtn').disabled = undoStack.length === 0;
                document.getElementById('redoBtn').disabled = redoStack.length === 0;
            }

            // Font size buttons
            document.getElementById('decreaseFont').addEventListener('click', () => {
                const selection = window.getSelection();
                const range = selection.getRangeAt(0);
                const span = document.createElement('span');
                
                if (selection.toString().length > 0) {
                    const currentSize = parseInt(window.getComputedStyle(range.commonAncestorContainer).fontSize);
                    const newSize = Math.max(2, currentSize - 2);
                    span.style.fontSize = newSize + 'px';
                    range.surroundContents(span);
                } else {
                    editor.style.fontSize = Math.max(2, parseInt(window.getComputedStyle(editor).fontSize) - 2) + 'px';
                }
                saveToHistory();
            });

            document.getElementById('increaseFont').addEventListener('click', () => {
                const selection = window.getSelection();
                const range = selection.getRangeAt(0);
                const span = document.createElement('span');
                
                if (selection.toString().length > 0) {
                    const currentSize = parseInt(window.getComputedStyle(range.commonAncestorContainer).fontSize);
                    span.style.fontSize = (currentSize + 2) + 'px';
                    range.surroundContents(span);
                } else {
                    editor.style.fontSize = (parseInt(window.getComputedStyle(editor).fontSize) + 2) + 'px';
                }
                saveToHistory();
            });

            document.getElementById('resetFont').addEventListener('click', () => {
                const selection = window.getSelection();
                if (selection.toString().length > 0) {
                    const range = selection.getRangeAt(0);
                    const span = document.createElement('span');
                    span.style.fontSize = '16px';
                    range.surroundContents(span);
                } else {
                    editor.style.fontSize = '16px';
                }
                saveToHistory();
            });

            // Undo/Redo functionality
            document.getElementById('undoBtn').addEventListener('click', () => {
                if (undoStack.length > 0) {
                    redoStack.push(editor.innerHTML);
                    if (redoStack.length > MAX_HISTORY) {
                        redoStack.shift();
                    }
                    editor.innerHTML = undoStack.pop();
                    updateUndoRedoButtons();
                }
            });

            document.getElementById('redoBtn').addEventListener('click', () => {
                if (redoStack.length > 0) {
                    undoStack.push(editor.innerHTML);
                    if (undoStack.length > MAX_HISTORY) {
                        undoStack.shift();
                    }
                    editor.innerHTML = redoStack.pop();
                    updateUndoRedoButtons();
                }
            });

            // Save to history on content changes
            editor.addEventListener('input', () => {
                saveToHistory();
            });

            // Word and character count
            editor.addEventListener('input', () => {
                const text = editor.innerText;
                const words = text.trim().split(/\s+/).length;
                const chars = text.length;

                wordCount.textContent = `Words: ${words}`;
                charCount.textContent = `Characters: ${chars}`;
            });

            // File operations
            document.getElementById('newFile').addEventListener('click', () => {
                if (confirm('Are you sure? Any unsaved changes will be lost.')) {
                    editor.innerHTML = '<p>Start writing something amazing...</p>';
                }
            });

            document.getElementById('saveFile').addEventListener('click', () => {
                const content = editor.innerHTML;
                const blob = new Blob([content], { type: 'text/markdown' });
                const a = document.createElement('a');
                a.download = 'document.md.txt';
                a.href = URL.createObjectURL(blob);
                a.click();
            });

            document.getElementById('openFile').addEventListener('click', () => {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.md.txt,.md,.txt';
                input.onchange = e => {
                    const file = e.target.files[0];
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        editor.innerHTML = e.target.result;
                    };
                    reader.readAsText(file);
                };
                input.click();
            });

            // Font modal
            document.getElementById('fontBtn').addEventListener('click', () => {
                fontModal.style.display = 'block';
                loadGoogleFonts();
            });

            fontModal.addEventListener('click', (e) => {
                if (e.target === fontModal) {
                    fontModal.style.display = 'none';
                }
            });

            // Color picker
            document.getElementById('textColor').addEventListener('click', (e) => {
                colorPicker.style.display = colorPicker.style.display === 'block' ? 'none' : 'block';
                colorPicker.style.top = e.target.offsetTop + 40 + 'px';
                colorPicker.style.left = e.target.offsetLeft + 'px';
            });

            document.querySelectorAll('.color-option').forEach(option => {
                option.addEventListener('click', () => {
                    const color = option.style.backgroundColor;
                    document.execCommand('foreColor', false, color);
                    colorPicker.style.display = 'none';
                });
            });

            // Link insertion
            document.getElementById('insertLink').addEventListener('click', () => {
                const url = prompt('Enter URL:');
                if (url) {
                    document.execCommand('createLink', false, url);
                }
            });

            // Image insertion
            document.getElementById('insertImage').addEventListener('click', () => {
                const url = prompt('Enter image URL:');
                if (url) {
                    document.execCommand('insertImage', false, url);
                }
            });

            // Google Fonts integration
            async function loadGoogleFonts() {
                try {
                    fontList.innerHTML = '<div class="loading">Loading fonts...</div>';
                    
                    // Using Google Fonts API
                    const response = await fetch('https://www.googleapis.com/webfonts/v1/webfonts?key=AIzaSyBQLkoEkGx_YqdvDtFagX6aebroAUIAhCk');
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const data = await response.json();
                    
                    if (!data || !data.items || !Array.isArray(data.items)) {
                        throw new Error('Invalid font data structure received');
                    }

                    const fonts = data.items
                        .filter(font => font && font.family)
                        .map(font => ({
                            family: font.family,
                            category: font.category
                        }));

                    // Update favorites list
                    const favoritesList = document.querySelector('.favorites-list');
                    favoritesList.innerHTML = favorites.length ? 
                        favorites.map(family => `
                            <div class="font-item favorite" style="font-family: '${family}'">
                                <div class="font-preview" style="font-family: '${family}'">
                                    ${family}
                                    <div class="preview-text">The quick brown fox jumps over the lazy dog</div>
                                </div>
                                <div class="font-actions">
                                    <button class="favorite-btn active">‚òÖ</button>
                                    <button class="use-font-btn">Use Font</button>
                                </div>
                            </div>
                        `).join('') :
                        '<div class="empty-message">No favorite fonts yet</div>';

                    // Show common fonts first
                    const commonFonts = ['Arial', 'Times New Roman', 'Helvetica', 'Georgia', 'Verdana'];
                    const commonFontItems = fonts.filter(font => commonFonts.includes(font.family));
                    const otherFontItems = fonts.filter(font => !commonFonts.includes(font.family));
                    
                    fontList.innerHTML = [
                        ...commonFontItems,
                        ...otherFontItems
                    ].map(font => `
                        <div class="font-item ${favorites.includes(font.family) ? 'favorite' : ''}" 
                             style="font-family: '${font.family}'">
                            <div class="font-preview" style="font-family: '${font.family}'">
                                ${font.family}
                                <div class="preview-text">The quick brown fox jumps over the lazy dog</div>
                            </div>
                            <small>(${font.category})</small>
                            <button class="favorite-btn ${favorites.includes(font.family) ? 'active' : ''}">‚òÖ</button>
                            <button class="use-font-btn">Use Font</button>
                        </div>
                    `).join('');
                } catch (error) {
                    console.error('Error loading Google Fonts:', error);
                    console.error('Google Fonts Error:', error);
                    fontList.innerHTML = '<div class="error">Could not load Google Fonts. Using system fonts.</div>';
                    
                    // Extended fallback font list with web-safe fonts
                    const basicFonts = [
                        'Arial', 'Times New Roman', 'Helvetica', 
                        'Georgia', 'Verdana', 'Courier New',
                        'Tahoma', 'Trebuchet MS', 'Impact',
                        'Comic Sans MS', 'Palatino', 'Garamond',
                        'Calibri', 'Cambria', 'Segoe UI',
                        'Open Sans', 'Roboto', 'Lato'
                    ];
                    fontList.innerHTML = basicFonts.map(font => `
                        <div class="font-item ${favorites.includes(font) ? 'favorite' : ''}" 
                             style="font-family: '${font}'">
                            ${font}
                            <button class="favorite-btn">‚òÖ</button>
                        </div>
                    `).join('');
                }

                // Font search
                fontSearch.addEventListener('input', (e) => {
                    const searchTerm = e.target.value.toLowerCase();
                    document.querySelectorAll('.font-item').forEach(item => {
                        const fontName = item.textContent.toLowerCase();
                        item.style.display = fontName.includes(searchTerm) ? 'block' : 'none';
                    });
                });

                // Tab switching
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                        btn.classList.add('active');
                        document.getElementById(btn.dataset.tab).classList.add('active');
                    });
                });

                // Font selection and favorite toggling
                document.querySelectorAll('.font-item').forEach(item => {
                    const fontBtn = item.querySelector('.favorite-btn');
                    const useBtn = item.querySelector('.use-font-btn');
                    const fontFamily = item.style.fontFamily.replace(/['"]/g, '');
                        
                    // Preview font on item click
                    item.addEventListener('click', () => {
                        document.querySelector('.preview-text').style.fontFamily = fontFamily;
                    });
                
                    // Use font button
                    if (useBtn) {
                        useBtn.addEventListener('click', () => {
                            document.execCommand('fontName', false, fontFamily);
                            fontModal.style.display = 'none';
                        });
                    }

                    // Favorite toggling
                    fontBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        if (favorites.includes(fontFamily)) {
                            favorites = favorites.filter(f => f !== fontFamily);
                            fontBtn.classList.remove('active');
                        } else {
                            favorites.push(fontFamily);
                            fontBtn.classList.add('active');
                        }
                        localStorage.setItem('favoriteFonts', JSON.stringify(favorites));
                        loadGoogleFonts(); // Refresh lists
                    });
                });
            }

            // Handle keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key.toLowerCase()) {
                        case 's':
                            e.preventDefault();
                            document.getElementById('saveFile').click();
                            break;
                        case 'o':
                            e.preventDefault();
                            document.getElementById('openFile').click();
                            break;
                        case 'b':
                            e.preventDefault();
                            document.execCommand('bold', false, null);
                            break;
                        case 'i':
                            e.preventDefault();
                            document.execCommand('italic', false, null);
                            break;
                        case 'u':
                            e.preventDefault();
                            document.execCommand('underline', false, null);
                            break;
                    }
                }
            });

            // Dark mode toggle
            const darkModeBtn = document.getElementById('toggleDarkMode');
            darkModeBtn.addEventListener('click', () => {
                document.body.classList.toggle('dark-mode');
                const icon = darkModeBtn.querySelector('i');
                icon.classList.toggle('fa-moon');
                icon.classList.toggle('fa-sun');
            });

            // Text-to-speech
            const speechBtn = document.getElementById('toggleSpeech');
            let speaking = false;
            speechBtn.addEventListener('click', () => {
                if (!speaking) {
                    const text = editor.innerText;
                    const utterance = new SpeechSynthesisUtterance(text);
                    speechSynthesis.speak(utterance);
                    speaking = true;
                    speechBtn.classList.add('active');
                } else {
                    speechSynthesis.cancel();
                    speaking = false;
                    speechBtn.classList.remove('active');
                }
            });

            // Help modal
            const helpModal = document.getElementById('helpModal');
            const helpBtn = document.getElementById('helpBtn');
            const closeHelp = document.getElementById('closeHelp');

            helpBtn.addEventListener('click', () => {
                helpModal.style.display = 'block';
            });

            closeHelp.addEventListener('click', () => {
                helpModal.style.display = 'none';
            });

            // Close modals when clicking outside
            window.addEventListener('click', (e) => {
                if (!e.target.closest('#colorPicker') && !e.target.closest('#textColor')) {
                    colorPicker.style.display = 'none';
                }
                if (e.target === helpModal) {
                    helpModal.style.display = 'none';
                }
            });

            // Add tooltips to all toolbar buttons
            document.querySelectorAll('.toolbar .btn').forEach(btn => {
                if (!btn.hasAttribute('data-tooltip')) {
                    const command = btn.getAttribute('data-command');
                    if (command) {
                        btn.setAttribute('data-tooltip', command.replace(/([A-Z])/g, ' $1').trim());
                    }
                }
            });

            // Tabs functionality
            const tabsContainer = document.querySelector('.tabs-container');
            const newTabBtn = document.querySelector('.new-tab-btn');
            let tabCount = 1;
            let activeTab = 1;

            function createNewTab() {
                tabCount++;
                const tab = document.createElement('div');
                tab.className = 'tab';
                tab.innerHTML = `Document ${tabCount}<span class="tab-close">√ó</span>`;
                
                tabsContainer.insertBefore(tab, newTabBtn);
                switchToTab(tabCount);
                
                // Save current content
                saveTabContent(activeTab);
                
                // Clear editor for new tab
                editor.innerHTML = '<p>Start writing something amazing...</p>';
            }

            function switchToTab(tabNumber) {
                // Save current content
                saveTabContent(activeTab);
                
                // Update active tab
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelector(`.tab:nth-child(${tabNumber})`).classList.add('active');
                
                // Load content for new tab
                activeTab = tabNumber;
                loadTabContent(tabNumber);
            }

            function saveTabContent(tabNumber) {
                localStorage.setItem(`tab_${tabNumber}`, editor.innerHTML);
            }

            function loadTabContent(tabNumber) {
                const content = localStorage.getItem(`tab_${tabNumber}`);
                editor.innerHTML = content || '<p>Start writing something amazing...</p>';
            }

            newTabBtn.addEventListener('click', createNewTab);

            tabsContainer.addEventListener('click', (e) => {
                if (e.target.classList.contains('tab-close')) {
                    const tab = e.target.parentElement;
                    const tabNumber = Array.from(tabsContainer.children).indexOf(tab) + 1;
                    
                    if (document.querySelectorAll('.tab').length > 1) {
                        tab.remove();
                        localStorage.removeItem(`tab_${tabNumber}`);
                        
                        if (tabNumber === activeTab) {
                            switchToTab(1);
                        }
                    }
                } else if (e.target.classList.contains('tab')) {
                    const tabNumber = Array.from(tabsContainer.children).indexOf(e.target) + 1;
                    switchToTab(tabNumber);
                }
            });

            // Emoji picker functionality
            const emojiBtn = document.getElementById('emojiBtn');
            const emojiPicker = document.querySelector('.emoji-picker');
            const emojiGrid = document.querySelector('.emoji-grid');

            const emojiCategories = {
                smileys: ['üòÄ', 'üòÉ', 'üòÑ', 'üòÅ', 'üòÖ', 'üòÇ', 'ü§£', 'üòä'],
                people: ['üëã', 'ü§ö', 'üñêÔ∏è', '‚úã', 'üññ', 'üëå', 'ü§å', 'ü§è'],
                animals: ['üê∂', 'üê±', 'üê≠', 'üêπ', 'üê∞', 'ü¶ä', 'üêª', 'üêº'],
                food: ['üçé', 'üçê', 'üçä', 'üçã', 'üçå', 'üçâ', 'üçá', 'üçì'],
                activities: ['‚öΩ', 'üèÄ', 'üèà', '‚öæ', 'ü•é', 'üéæ', 'üèê', 'üèâ'],
                travel: ['üöó', 'üöï', 'üöô', 'üöå', 'üöé', 'üèéÔ∏è', 'üöì', 'üöë'],
                objects: ['üí°', 'üî¶', 'üèÆ', 'ü™î', 'üì±', 'üì≤', 'üíª', '‚å®Ô∏è'],
                symbols: ['‚ù§Ô∏è', 'üß°', 'üíõ', 'üíö', 'üíô', 'üíú', 'üñ§', 'ü§ç']
            };

            function showEmojiCategory(category) {
                emojiGrid.innerHTML = emojiCategories[category]
                    .map(emoji => `<div class="emoji">${emoji}</div>`)
                    .join('');
            }

            emojiBtn.addEventListener('click', (e) => {
                emojiPicker.style.display = emojiPicker.style.display === 'block' ? 'none' : 'block';
                emojiPicker.style.top = e.target.offsetTop + 40 + 'px';
                emojiPicker.style.left = e.target.offsetLeft + 'px';
                showEmojiCategory('smileys');
            });

            document.querySelectorAll('.emoji-category').forEach(category => {
                category.addEventListener('click', () => {
                    showEmojiCategory(category.dataset.category);
                });
            });

            emojiGrid.addEventListener('click', (e) => {
                if (e.target.classList.contains('emoji')) {
                    document.execCommand('insertText', false, e.target.textContent);
                    emojiPicker.style.display = 'none';
                }
            });

            // Close emoji picker when clicking outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.emoji-picker') && !e.target.closest('#emojiBtn')) {
                    emojiPicker.style.display = 'none';
                }
            });
        });
    </script></body></html>
